---
layout: post
title: "[DATA] - VSCODE에 AKS 연결하기"
author: nasa1515
categories: DATA
date: 2021-03-19 11:36
comments: true
cover: "/assets/1800-550.jpg"
tags: DATA
---



## **VSCODE에 AKS 연결하기**


<br/>

**머리말**  

**추후에 Kafka를 k8s Cluster 환경에서 설치 및 구동을 해보려고 합니다.**  
**그래서 일단 YAM을 더 효율적이게 생성하기 위해 VSCODE와 AKS를 연결해봅시다.**  





  


 
---

**DATA 시리즈**

**이론**



 - [Apache Spark](https://nasa1515.github.io/data/2021/03/03/spark.html)


**실습** 

 - [Azure Synapse Analytics](https://nasa1515.github.io/data/2021/02/25/azure-synapse.html)
 - [Azure VM에 Apache Spark v3.0 Standalone 설치 With Zeppelin](https://nasa1515.github.io/data/2021/03/04/Spark2.html)
 - [Hadoop 3.3.0 Full Distribute mode infra 구축](https://nasa1515.github.io/data/2021/03/08/hadoop.html)
 - [Apache Spark v3.0 on yarn 설치 With Zeppelin](https://nasa1515.github.io/data/2021/03/10/spark-yarn.html)

---



**목차**


- [AKS 구성](#a1)
- [GCP DP](#a2)
- [Azure DP](#a3)


--- 

<br/>

## **AKS 구성**   <a name="a1"></a>     

#### **저는 Azure의 공식 DOC로 CLI를 이용해서 AKS Cluster를 구축했습니다.** 

* #### **[Azure AKS DOC](https://docs.microsoft.com/ko-kr/azure/aks/kubernetes-walkthrough)**  
* #### **[Azure Portal 용 AKS DOC](https://docs.microsoft.com/ko-kr/azure/aks/kubernetes-walkthrough-portal)**


<br/>


#### **Cluster 생성이 완료되었다면 아래와 같이 RG들과 Resource들이 생성됩니다.**  

![123](https://user-images.githubusercontent.com/69498804/112254765-762b3380-8ca4-11eb-88b9-b64266de090c.JPG)


<br/>


#### **이제 Cloud shell에서 kubelet 명령어를 입력해보려고 했으나 ERROR가 발생하네요?**  

![캡처](https://user-images.githubusercontent.com/69498804/112254836-9529c580-8ca4-11eb-9edf-f971a165e43b.JPG)

* **Cloud shell과 aks 사이에 인증이 필요해서 이런거였습니다!!**  

<br/>

#### **다음 명령어로 credentials을 가져 올 수 있었습니다.**

```
az aks get-credentials --resource-group [myResourceGroup] --name [myAKSCluster]
```

<br/>

#### **Credentials을 가져온 뒤 kebectl 명령은 정상적입니다.**

![캡처2](https://user-images.githubusercontent.com/69498804/112256786-97d9ea00-8ca7-11eb-90a6-56a7150ef2b7.JPG)

<br/>


#### **사실 위에서 한 작업들로만으로도 VSCODE의 terminal에선 연결이 가능합니다.**  

![캡처3333](https://user-images.githubusercontent.com/69498804/112258604-1afc3f80-8caa-11eb-8641-fe03947a05a8.JPG)

* **다만 저는 왼쪽의 File list로 yaml file을 관리하고 싶습니다.**  



<br/>


#### **그래서 VSCODE의 extentions을 사용해서 AKS와 직접 연결하는 방법을 찾았습니다.**  

<br/>


* **[가이드](https://mountainss.wordpress.com/2018/07/17/create-azure-kubernetes-cluster-and-manage-in-visual-studio-code-vsc-kubernetes-cloud/)** 

<br/>

#### **위의 링크에서 설명하는 방법은 다음과 같습니다.**  

<br/>

* #### **1. AKS Cluster 생성** 
* #### **2. Local에 Azure CLI 설치**
* #### **3. vscode에 kubernetes extentions 설치** 
* #### **4. kubernetes extentions을 사용해 AKS와 직접 연결** 

<br/>


#### **1,2번은 이미 완료했습니다. 이후 Azure cli에 연결하는 방법은 다음과 같습니다.**  


* #### **az aks install-cli** 

    ![캡처4](https://user-images.githubusercontent.com/69498804/112259140-1ab07400-8cab-11eb-9abc-8341b85fff04.JPG)

    <br/>

* #### **az login 명령으로 azure 로그인**

    ![캡처5555](https://user-images.githubusercontent.com/69498804/112259289-5f3c0f80-8cab-11eb-906e-ccc957cdc10e.JPG)


<br/>


* #### **AKS의 Credentials 가져오기**  

    ***az aks get-credentials --resource-group k8s --name nasa1515***  

    ![캡처666](https://user-images.githubusercontent.com/69498804/112259355-80046500-8cab-11eb-8a94-b990a1a72a08.JPG)


    <br/>

* #### **AKS의 dashboard 실행시키기**  

    ***az aks browse --resource-group k8s --name nasa1515*** 

    ![캡처6666](https://user-images.githubusercontent.com/69498804/112259585-e5585600-8cab-11eb-903d-e05c85c33f60.JPG)
    

<br/>


* #### **위의 작업을 완료하면 vscode의 extentions에서 구독을 설정할 수 있습니다.**  

    ![캡처77777](https://user-images.githubusercontent.com/69498804/112259771-2ea8a580-8cac-11eb-87a4-b88237ea493f.JPG)


    <br/>


* #### **정상적으로 Cluster를 추가했으나 옆의 목록에 뜨지 않는 이슈가 있네요**  

    ![캡처32323](https://user-images.githubusercontent.com/69498804/112261431-31f16080-8caf-11eb-835b-f4b44fe0a015.JPG)

    * **해당 이슈는 vscode를 실행하는 local에 kubectl이 설치되지 않은 이슈였습니다.**  




<br/>


* #### **vscode가 설치되어있는 window에 kubectl을 설치해보죠**  

* **[가이드](https://kubernetes.io/ko/docs/tasks/tools/install-kubectl-windows/)**  

    <br/>

    #### **설치 방법은 다음과 같습니다.**  

    <br/>

    * **1. curl로 kubectl 바이너리 설치**  

        ```
        curl -LO https://dl.k8s.io/release/v1.20.0/bin/windows/amd64/kubectl.exe
        ```

        <br/>

    * **2. 바이너리 검증**  

        ```
        ### checksum file download 

        curl -LO https://dl.k8s.io/v1.20.0/bin/windows/amd64/kubectl.exe.sha256
        ```
        
        <br/>

    * **3. checksum file로 검증**  
        
        ```
        CertUtil -hashfile kubectl.exe SHA256
        type kubectl.exe.sha256
        ```

        ```
        ### 점검 결과 동일
        C:\Users\USER>CertUtil -hashfile kubectl.exe SHA256                                                                                                                                                                                   SHA256의 kubectl.exe 해시:                                                                                                                                                                                                            ee7be8e93349fb0fd1db7f5cdb5985f5698cef69b7b7be012fc0e6bed06b254d                                                                                                                                                                      CertUtil: -hashfile 명령이 성공적으로 완료되었습니다.                                                                                                                                                                                                                                                                                                                                                                                                                       C:\Users\USER>type kubectl.exe.sha256                                                                                                                                                                                                 ee7be8e93349fb0fd1db7f5cdb5985f5698cef69b7b7be012fc0e6bed06b254d                                                                                                                                                                      C:\Users\USER>
        ````

    <br/>

    * **4. kubectl version 확인** 

        ```
        C:\Users\USER>kubectl version --client
        Client Version: version.Info{Major:"1", Minor:"20", GitVersion:"v1.20.0", GitCommit:"af46c47ce925f4c4ad5cc8d1fca46c7b77d13b38", GitTreeState:"clean", BuildDate:"2020-12-08T17:59:43Z", GoVersion:"go1.15.5", Compiler:"gc", Platform:"windows/amd64"}
        ```


<br/>


